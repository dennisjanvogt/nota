{% extends 'base_modern.html' %}
{% load static %}

{% block title %}Meine Aufgaben - Notariatskammer Verwaltung{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div class="page-header-top">
        <div>
            <h1 class="page-title">
                <i class="bi bi-check2-square"></i> Meine Aufgaben
            </h1>
            <p class="page-subtitle">Alle mir zugewiesenen Workflow-Schritte</p>
        </div>
        {% if aufgaben %}
        <div class="page-actions">
            <span class="badge badge-primary" style="font-size: 16px; padding: 8px 16px;">
                {{ aufgaben.count }} offene Aufgabe{{ aufgaben.count|pluralize:"n" }}
            </span>
        </div>
        {% endif %}
    </div>
</div>

<!-- Aufgaben Liste -->
{% if aufgaben %}
    {% for aufgabe in aufgaben %}
    <div class="card" style="margin-bottom: var(--spacing-lg);">
        <div class="card-body">
            <div style="display: grid; grid-template-columns: auto 1fr auto; gap: var(--spacing-lg); align-items: start;">
                <!-- Schritt-Nummer -->
                <div style="text-align: center;">
                    <span class="badge badge-warning" style="font-size: 20px; padding: 12px 16px; min-width: 50px;">
                        {{ aufgabe.workflow_schritt.reihenfolge }}
                    </span>
                </div>

                <!-- Aufgaben-Info -->
                <div>
                    <h3 style="font-size: 18px; font-weight: 600; margin-bottom: var(--spacing-sm); color: var(--text-primary);">
                        {{ aufgabe.workflow_schritt.name }}
                    </h3>
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: var(--spacing-xs);">
                        <i class="bi bi-diagram-3"></i>
                        <strong>{{ aufgabe.workflow_instanz.name }}</strong>
                    </div>
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: var(--spacing-sm);">
                        {{ aufgabe.workflow_instanz.workflow_typ.name }}
                        {% if aufgabe.workflow_instanz.aktenzeichen %}
                        <span style="margin-left: 12px;">
                            <strong style="font-family: 'SF Mono', 'Monaco', monospace; color: var(--primary-color);">
                                {{ aufgabe.workflow_instanz.aktenzeichen.vollstaendige_nummer }}
                            </strong>
                        </span>
                        {% endif %}
                    </div>

                    {% if aufgabe.workflow_schritt.beschreibung %}
                    <div style="margin-top: var(--spacing-sm); padding: var(--spacing-sm); background: var(--bg-primary); border-radius: var(--border-radius); font-size: 13px; color: var(--text-secondary);">
                        <strong>Beschreibung:</strong> {{ aufgabe.workflow_schritt.beschreibung }}
                    </div>
                    {% endif %}

                    <div style="display: flex; gap: var(--spacing-lg); margin-top: var(--spacing-sm); font-size: 13px; color: var(--text-secondary);">
                        {% if aufgabe.faellig_am %}
                        <div>
                            <i class="bi bi-calendar-event"></i>
                            <strong>Fällig am:</strong>
                            <span style="{% if aufgabe.faellig_am < today %}color: var(--danger); font-weight: 600;{% endif %}">
                                {{ aufgabe.faellig_am|date:"d.m.Y" }}
                            </span>
                        </div>
                        {% endif %}
                        {% if aufgabe.workflow_schritt.geschaetzte_dauer_tage %}
                        <div>
                            <i class="bi bi-clock"></i>
                            <strong>Dauer:</strong> ca. {{ aufgabe.workflow_schritt.geschaetzte_dauer_tage }} Tage
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Aktionen -->
                <div style="display: flex; flex-direction: column; gap: var(--spacing-xs); min-width: 140px;">
                    <a href="{% url 'workflow_detail' aufgabe.workflow_instanz.id %}" class="btn btn-secondary btn-sm">
                        <i class="bi bi-eye"></i> Details
                    </a>
                    <a href="{% url 'schritt_abschliessen' aufgabe.id %}" class="btn btn-success btn-sm">
                        <i class="bi bi-check"></i> Abschließen
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
{% else %}
    <div class="empty-state" style="padding: var(--spacing-2xl);">
        <div class="empty-state-icon" style="color: var(--success);">
            <i class="bi bi-check-circle"></i>
        </div>
        <h3 class="empty-state-title">Keine offenen Aufgaben!</h3>
        <p class="empty-state-text">
            Großartig! Sie haben aktuell keine offenen Aufgaben. Alle Ihre zugewiesenen
            Workflow-Schritte sind abgeschlossen.
        </p>
        <a href="{% url 'dashboard' %}" class="btn btn-primary">
            <i class="bi bi-house"></i> Zum Dashboard
        </a>
    </div>
{% endif %}

{% endblock %}

{% block extra_css %}
<style>
    @media (max-width: 768px) {
        .card-body > div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
            text-align: center;
        }
        .card-body > div[style*="grid-template-columns"] > div:last-child {
            flex-direction: row !important;
            justify-content: center;
        }
    }
</style>
{% endblock %}
