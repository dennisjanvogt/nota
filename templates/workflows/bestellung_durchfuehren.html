{% extends 'base_modern.html' %}

{% block title %}Bestellung durchführen - {{ workflow.name }}{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-header-top">
        <div>
            <h1 class="page-title">
                <i class="bi bi-award"></i> Bestellung zum Notar
            </h1>
            <p class="page-subtitle">{{ workflow.name }}</p>
        </div>
        <div class="page-actions">
            <a href="{% url 'workflow_detail' workflow.id %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Zurück
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-lg-8">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Notar-Bestellung</h2>
            </div>
            <div class="card-body">
                <div style="background: var(--bg-primary); padding: var(--spacing-md); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg);">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 4px;">
                        Erstplatzierter wird zum Notar bestellt:
                    </div>
                    <div style="font-size: 20px; font-weight: 600; color: var(--primary-color);">
                        {{ anwaerter.titel }} {{ anwaerter.vorname }} {{ anwaerter.nachname }}
                    </div>
                    <div style="font-size: 14px; color: var(--text-secondary); margin-top: 4px;">
                        Anwärter-ID: {{ anwaerter.anwaerter_id }}
                    </div>
                </div>

                <form method="post">
                    {% csrf_token %}

                    <div class="form-group">
                        <label for="notarstelle" class="form-label required">Notarstelle</label>
                        <select name="notarstelle" id="notarstelle" class="form-control" required>
                            <option value="">Wählen Sie eine Notarstelle...</option>
                            {% for stelle in notarstellen %}
                            <option value="{{ stelle.id }}">
                                {{ stelle.bezeichnung }} - {{ stelle.name }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="bestellt_am" class="form-label required">Bestellungsdatum</label>
                        <input type="date"
                               name="bestellt_am"
                               id="bestellt_am"
                               class="form-control"
                               value="{% now 'Y-m-d' %}"
                               required>
                    </div>

                    <div style="background: var(--warning-bg); border-left: 4px solid var(--warning-color); padding: var(--spacing-md); margin: var(--spacing-lg) 0;">
                        <div style="font-weight: 600; margin-bottom: 4px;">
                            <i class="bi bi-exclamation-triangle"></i> Wichtiger Hinweis
                        </div>
                        <div style="font-size: 14px;">
                            Durch diese Aktion wird:
                            <ul style="margin: 8px 0 0 20px;">
                                <li>Ein neuer Notar mit den Daten des Anwärters erstellt</li>
                                <li>Der Anwärter als inaktiv markiert (bleibt für Historie erhalten)</li>
                                <li>Der Workflow automatisch als "Abgeschlossen" markiert</li>
                            </ul>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-award"></i> Bestellung durchführen
                        </button>
                        <a href="{% url 'workflow_detail' workflow.id %}" class="btn btn-secondary">
                            Abbrechen
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title" style="font-size: 16px;">Anwärter-Daten</h3>
            </div>
            <div class="card-body">
                <div style="margin-bottom: var(--spacing-sm);">
                    <strong style="display: block; font-size: 13px; color: var(--text-secondary);">E-Mail:</strong>
                    <div>{{ anwaerter.email }}</div>
                </div>
                <div style="margin-bottom: var(--spacing-sm);">
                    <strong style="display: block; font-size: 13px; color: var(--text-secondary);">Telefon:</strong>
                    <div>{{ anwaerter.telefon|default:"—" }}</div>
                </div>
                <div style="margin-bottom: var(--spacing-sm);">
                    <strong style="display: block; font-size: 13px; color: var(--text-secondary);">Zugelassen am:</strong>
                    <div>{{ anwaerter.zugelassen_am|date:"d.m.Y"|default:"—" }}</div>
                </div>
                <div>
                    <strong style="display: block; font-size: 13px; color: var(--text-secondary);">Aktuelle Notarstelle:</strong>
                    <div>{{ anwaerter.notarstelle.name|default:"—" }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
