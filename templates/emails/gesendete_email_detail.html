{% extends 'base_modern.html' %}
{% load static %}

{% block title %}{{ email.betreff }} - E-Mail Details{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div style="display: flex; align-items: center; justify-content: space-between; gap: var(--spacing-xl);">
        <div>
            <h1 class="page-title">
                <i class="bi bi-envelope-open"></i> E-Mail Details
            </h1>
            <p class="page-subtitle">{{ email.betreff }}</p>
        </div>
        <div style="display: flex; gap: var(--spacing-sm);">
            <a href="{% url 'gesendete_emails' %}" class="btn btn-secondary">
                <i class="bi bi-arrow-left"></i> Zur체ck zur Liste
            </a>
        </div>
    </div>
</div>

<!-- Status Badge -->
<div style="margin-bottom: var(--spacing-lg);">
    {% if email.erfolgreich %}
    <span class="badge bg-success" style="font-size: 14px; padding: 8px 16px;">
        <i class="bi bi-check-circle"></i> Erfolgreich versendet
    </span>
    {% else %}
    <span class="badge bg-danger" style="font-size: 14px; padding: 8px 16px;">
        <i class="bi bi-x-circle"></i> Versand fehlgeschlagen
    </span>
    {% endif %}
</div>

<!-- E-Mail Metadaten Card -->
<div class="card" style="margin-bottom: var(--spacing-lg);">
    <div class="card-header">
        <h2 class="card-title">
            <i class="bi bi-info-circle"></i> E-Mail Informationen
        </h2>
    </div>
    <div class="card-body">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
            <!-- Linke Spalte -->
            <div>
                <div style="margin-bottom: var(--spacing-md);">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Empf채nger</div>
                    <div style="font-size: 15px; font-weight: 500;">{{ email.empfaenger }}</div>
                </div>

                {% if email.cc_empfaenger %}
                <div style="margin-bottom: var(--spacing-md);">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">CC</div>
                    <div style="font-size: 15px; font-weight: 500;">{{ email.cc_empfaenger }}</div>
                </div>
                {% endif %}

                <div style="margin-bottom: var(--spacing-md);">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Versendet von</div>
                    <div style="font-size: 15px; font-weight: 500;">{{ email.gesendet_von.get_full_name|default:email.gesendet_von.username }}</div>
                </div>

                <div style="margin-bottom: var(--spacing-md);">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Versendet am</div>
                    <div style="font-size: 15px; font-weight: 500;">{{ email.gesendet_am|date:"d.m.Y H:i" }} Uhr</div>
                </div>
            </div>

            <!-- Rechte Spalte -->
            <div>
                <div style="margin-bottom: var(--spacing-md);">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Vorlage</div>
                    <div style="font-size: 15px; font-weight: 500;">
                        {% if email.vorlage %}
                        <a href="{% url 'vorlage_detail' vorlage_id=email.vorlage.id %}">
                            {{ email.vorlage.name }}
                        </a>
                        {% else %}
                        <span style="color: var(--text-secondary);">Manuell erstellt</span>
                        {% endif %}
                    </div>
                </div>

                {% if email.notar %}
                <div style="margin-bottom: var(--spacing-md);">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Bezug zu Notar</div>
                    <div style="font-size: 15px; font-weight: 500;">
                        <a href="{% url 'notar_detail' notar_id=email.notar.notar_id %}">
                            {{ email.notar.get_voller_name }}
                        </a>
                    </div>
                </div>
                {% endif %}

                {% if email.anwaerter %}
                <div style="margin-bottom: var(--spacing-md);">
                    <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Bezug zu Kandidat</div>
                    <div style="font-size: 15px; font-weight: 500;">
                        <a href="{% url 'anwaerter_detail' anwaerter_id=email.anwaerter.anwaerter_id %}">
                            {{ email.anwaerter.get_voller_name }}
                        </a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- E-Mail Inhalt Card -->
<div class="card" style="margin-bottom: var(--spacing-lg);">
    <div class="card-header">
        <h2 class="card-title">
            <i class="bi bi-envelope-paper"></i> E-Mail Inhalt
        </h2>
    </div>
    <div class="card-body">
        <div style="margin-bottom: var(--spacing-md);">
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Betreff</div>
            <div style="font-size: 15px; font-weight: 600;">{{ email.betreff }}</div>
        </div>

        <div>
            <div style="font-size: 13px; color: var(--text-secondary); margin-bottom: 4px;">Nachricht</div>
            <div style="background-color: var(--bg-elevated); padding: var(--spacing-md); border-radius: 8px; border: 1px solid var(--border-color);">
                <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: inherit; margin: 0; font-size: 14px; line-height: 1.6;">{{ email.nachricht }}</pre>
            </div>
        </div>
    </div>
</div>

<!-- Fehler Card (nur wenn nicht erfolgreich) -->
{% if not email.erfolgreich and email.fehler %}
<div class="card" style="margin-bottom: var(--spacing-lg); border-left: 4px solid var(--danger);">
    <div class="card-header" style="background-color: var(--danger-bg);">
        <h2 class="card-title" style="color: var(--danger);">
            <i class="bi bi-exclamation-triangle"></i> Fehler beim Versand
        </h2>
    </div>
    <div class="card-body">
        <pre style="white-space: pre-wrap; word-wrap: break-word; color: #dc3545; margin: 0; font-size: 14px;">{{ email.fehler }}</pre>
    </div>
</div>
{% endif %}

<!-- Anh채nge Card (falls vorhanden) -->
{% if email.anhaenge.exists %}
<div class="card">
    <div class="card-header">
        <h2 class="card-title">
            <i class="bi bi-paperclip"></i> Anh채nge ({{ email.anhaenge.count }})
        </h2>
    </div>
    <div class="card-body">
        <ul style="list-style: none; padding: 0; margin: 0;">
            {% for dokument in email.anhaenge.all %}
            <li style="padding: var(--spacing-sm) 0; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; gap: var(--spacing-sm);">
                <i class="bi bi-file-earmark" style="font-size: 18px; color: var(--primary-color);"></i>
                <a href="{{ dokument.datei.url }}" target="_blank" style="flex: 1;">{{ dokument.titel }}</a>
                <span style="font-size: 12px; color: var(--text-secondary);">
                    {% if dokument.datei.size %}
                    {{ dokument.datei.size|filesizeformat }}
                    {% endif %}
                </span>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endif %}
{% endblock %}
